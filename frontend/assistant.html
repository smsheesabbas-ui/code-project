<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - CashFlow AI</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <style>
        .chat-container {
            height: calc(100vh - 200px);
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        .message {
            margin-bottom: 24px;
            display: flex;
            gap: 14px;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }
        
        .user-avatar {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .assistant-avatar {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .message-content {
            max-width: 70%;
            padding: 16px 20px;
            border-radius: 20px;
            line-height: 1.6;
            font-size: 14px;
            position: relative;
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border-bottom-right-radius: 6px;
            box-shadow: 0 2px 12px rgba(59, 130, 246, 0.3);
        }
        
        .assistant-message .message-content {
            background: white;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 6px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }
        
        .message-content p {
            margin: 0 0 8px 0;
        }
        
        .message-content p:last-child {
            margin-bottom: 0;
        }
        
        .message-content ul {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .message-content li {
            margin-bottom: 4px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .chat-input {
            flex: 1;
            padding: 14px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 25px;
            outline: none;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8fafc;
        }
        
        .chat-input:focus {
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .chat-input::placeholder {
            color: #94a3b8;
        }
        
        .send-button {
            padding: 14px 24px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.4);
        }
        
        .send-button:active {
            transform: translateY(0);
        }
        
        .typing-indicator {
            display: none;
            padding: 16px 20px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            border-bottom-left-radius: 6px;
            max-width: 70%;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        }
        
        .typing-dots {
            display: flex;
            gap: 6px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #64748b;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        
        /* Improve page header */
        .page-header {
            background: linear-gradient(135deg, white 0%, #f8fafc 100%);
            border-bottom: 1px solid #e2e8f0;
        }
        
        .page-title {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="logo">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="9" fill="url(#logoGradD)"/>
                    <path d="M10 16 C10 11.58 13.58 8 18 8" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                    <path d="M22 16 C22 20.42 18.42 24 14 24" stroke="white" stroke-width="2.5" stroke-linecap="round"/>
                    <circle cx="18" cy="8" r="2.2" fill="white"/>
                    <circle cx="14" cy="24" r="2.2" fill="white"/>
                    <defs>
                        <linearGradient id="logoGradD" x1="0" y1="0" x2="32" y2="32" gradientUnits="userSpaceOnUse">
                            <stop offset="0%" stop-color="#f97316"/>
                            <stop offset="100%" stop-color="#eab308"/>
                        </linearGradient>
                    </defs>
                </svg>
                <span class="logo-text">Cashflow</span>
            </a>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <a href="dashboard.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="3" width="7" height="7" rx="1"/>
                        <rect x="14" y="14" width="7" height="7" rx="1"/>
                        <rect x="3" y="14" width="7" height="7" rx="1"/>
                    </svg>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="transactions.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="2" x2="12" y2="22"/>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                    </svg>
                    <span class="nav-text">Transactions</span>
                </a>
                <a href="entities.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span class="nav-text">Customers & Suppliers</span>
                </a>
                <a href="insights.html" class="nav-item">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                    </svg>
                    <span class="nav-text">Insights</span>
                </a>
                <a href="assistant.html" class="nav-item active">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <span class="nav-text">Assistant</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-section-title">Data</span>
                <button class="nav-item" onclick="showCSVUploadModal()" style="background: none; border: none; text-align: left; width: 100%; padding: 12px 16px; display: flex; align-items: center; gap: 12px; color: #6b7280; text-decoration: none; border-radius: 8px; transition: all 0.2s ease; cursor: pointer;">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <span class="nav-text">Import CSV</span>
                </button>
            </div>
        </nav>

        <div class="sidebar-footer">
            <!-- Home Button -->
            <a href="index.html" class="sidebar-home-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                <span class="sidebar-home-text">Home</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-header">
            <div>
                <h1 class="page-title">AI Assistant</h1>
                <p class="page-description">Your financial companion powered by AI</p>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message assistant-message">
                    <div class="message-avatar assistant-avatar">AI</div>
                    <div class="message-content">
                        <p>Hello! I'm your CashFlow AI assistant. I can help you with:</p>
                        <ul>
                            <li>üí∞ Financial analysis and insights</li>
                            <li>üìä Cash flow forecasting</li>
                            <li>üí° Business recommendations</li>
                            <li>üìà Investment advice</li>
                            <li>üè¶ Banking and payment questions</li>
                        </ul>
                        <p>Feel free to ask me anything about your finances!</p>
                    </div>
                </div>
            </div>
            
            <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <input type="text" id="chatInput" class="chat-input" placeholder="Ask me anything about your finances..." onkeypress="handleKeyPress(event)">
                <button class="send-button" onclick="sendMessage()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22,2 15,22 11,13 2,9"/>
                    </svg>
                    Send
                </button>
            </div>
        </div>
    </main>

    <!-- CSV Upload Modal -->
    <div id="csvUploadModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import CSV Data</h3>
                <button class="modal-close" onclick="hideCSVUploadModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('file')">File Upload</button>
                        <button class="tab-button" onclick="switchTab('paste')">Paste Data</button>
                    </div>
                    <div class="tab-content">
                        <div id="fileTab" class="tab-pane active">
                            <div class="upload-area" id="uploadArea">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <p>Drag and drop your CSV file here, or click to browse</p>
                                <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                            </div>
                        </div>
                        <div id="pasteTab" class="tab-pane">
                            <textarea id="csvPasteArea" placeholder="Paste your CSV data here..." rows="10"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideCSVUploadModal()">Cancel</button>
                <button class="btn btn-primary" onclick="importCSV()">Import</button>
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script>
        // Demo responses for different types of questions
        const demoResponses = {
            greeting: [
                "Hello! I'm here to help with your financial questions. What would you like to know?",
                "Hi there! I can assist with financial analysis, cash flow questions, and business advice. How can I help?",
                "Welcome! I'm your AI financial assistant. Ask me anything about your finances!"
            ],
            cashflow: [
                "Based on your recent transactions, you have a healthy positive cash flow of $17,509.61. Your revenue exceeds expenses by a good margin, which is excellent for business growth.",
                "Your cash flow analysis shows strong performance with $21,427.05 in revenue against $3,917.44 in expenses. Consider maintaining this efficiency ratio.",
                "I can see you're managing cash flow well! With 22 transactions this period, your average transaction size is healthy. Keep monitoring your largest customer (Walmart) for diversification."
            ],
            revenue: [
                "Your total revenue of $21,427.05 this period is impressive! Walmart appears to be your largest customer. Consider strategies to diversify your revenue streams.",
                "Revenue analysis shows strong performance at $21,427.05. With consistent cash flow, you might want to explore expansion opportunities or new customer acquisition.",
                "Your revenue trends look positive! The average revenue per transaction is approximately $974, indicating good deal sizes. Focus on customer retention and acquisition."
            ],
            expenses: [
                "Your expenses of $3,917.44 are well-controlled, representing only 18% of your revenue. Utilities is your top expense category - review for optimization opportunities.",
                "Expense management looks excellent! Your expense-to-revenue ratio of 18% is very healthy. Continue monitoring utility costs and subscription services.",
                "Great expense control! With $3,917.44 in total expenses, you're maintaining lean operations. Consider if any subscriptions can be optimized or consolidated."
            ],
            investment: [
                "With strong positive cash flow, consider investing in short-term interest-bearing accounts or business expansion. Your current financial position supports calculated risks.",
                "Investment advice: Given your $17,509 positive cash flow, you could allocate funds to business growth, emergency reserves, or diversified investment portfolios.",
                "Your cash flow supports investment opportunities. Consider a mix of business reinvestment and personal financial growth vehicles."
            ],
            forecasting: [
                "Based on current trends, I forecast continued positive cash flow. Your consistent revenue pattern suggests stable growth potential.",
                "Financial forecasting indicates healthy trajectory. Maintain current operational efficiency while exploring growth opportunities.",
                "Your financial projections look positive! Current trends suggest continued growth with proper expense management."
            ],
            business: [
                "Business advice: Focus on customer diversification since Walmart represents significant revenue. Also consider scaling successful operational patterns.",
                "Your business shows strong fundamentals. Key recommendations: diversify customer base, optimize utility costs, and explore new revenue streams.",
                "Business analysis reveals solid performance. Consider strategic partnerships and operational scaling to leverage your current success."
            ],
            default: [
                "That's an interesting question! Based on your financial data, I can see you have strong cash flow and healthy revenue patterns. Could you provide more specific details?",
                "I'd be happy to help with that! Your financial profile shows good health with positive cash flow. What specific aspect would you like to explore?",
                "Great question! From your financial data, I can see you're managing expenses well and maintaining good revenue. How can I assist you further?"
            ]
        };

        function getResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Check for greetings
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                return getRandomResponse('greeting');
            }
            
            // Check for cash flow questions
            if (lowerMessage.includes('cash flow') || lowerMessage.includes('cashflow')) {
                return getRandomResponse('cashflow');
            }
            
            // Check for revenue questions
            if (lowerMessage.includes('revenue') || lowerMessage.includes('income') || lowerMessage.includes('earnings')) {
                return getRandomResponse('revenue');
            }
            
            // Check for expense questions
            if (lowerMessage.includes('expense') || lowerMessage.includes('cost') || lowerMessage.includes('spending')) {
                return getRandomResponse('expenses');
            }
            
            // Check for investment questions
            if (lowerMessage.includes('invest') || lowerMessage.includes('return') || lowerMessage.includes('portfolio')) {
                return getRandomResponse('investment');
            }
            
            // Check for forecasting questions
            if (lowerMessage.includes('forecast') || lowerMessage.includes('predict') || lowerMessage.includes('future')) {
                return getRandomResponse('forecasting');
            }
            
            // Check for business advice
            if (lowerMessage.includes('business') || lowerMessage.includes('company') || lowerMessage.includes('grow')) {
                return getRandomResponse('business');
            }
            
            // Default response
            return getRandomResponse('default');
        }

        function getRandomResponse(category) {
            const responses = demoResponses[category];
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Simulate AI response delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = getResponse(message);
                addMessage(response, 'assistant');
            }, 1000 + Math.random() * 1000);
        }

        function addMessage(content, type) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            const avatar = document.createElement('div');
            avatar.className = `message-avatar ${type}-avatar`;
            avatar.textContent = type === 'user' ? 'You' : 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = `<p>${content}</p>`;
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'block';
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // CSV Upload Functions (same as other pages)
        function showCSVUploadModal() {
            document.getElementById('csvUploadModal').style.display = 'block';
        }

        function hideCSVUploadModal() {
            document.getElementById('csvUploadModal').style.display = 'none';
        }

        function switchTab(tabName) {
            // Remove active class from all tabs and buttons
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Add active class to selected tab and button
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function importCSV() {
            // Demo CSV import function
            alert('CSV import functionality would be implemented here with API integration.');
            hideCSVUploadModal();
        }

        // File upload handling
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('csvFileInput');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#3b82f6';
            uploadArea.style.backgroundColor = '#eff6ff';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.style.backgroundColor = '#f9fafb';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#d1d5db';
            uploadArea.style.backgroundColor = '#f9fafb';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                // Handle file
            }
        });
    </script>
</body>
</html>
