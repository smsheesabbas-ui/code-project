<!DOCTYPE html>
<html>
<head>
    <title>CashFlow AI - API Test</title>
</head>
<body>
    <h1>CashFlow AI - Frontend API Test</h1>
    
    <div>
        <h2>Test CSV Upload</h2>
        <input type="file" id="testFile" accept=".csv">
        <button onclick="testUpload()">Test Upload</button>
        <div id="result"></div>
    </div>
    
    <script src="js/api.js"></script>
    <script>
        async function testUpload() {
            const fileInput = document.getElementById('testFile');
            const resultDiv = document.getElementById('result');
            
            if (fileInput.files.length === 0) {
                resultDiv.innerHTML = 'Please select a CSV file first';
                return;
            }
            
            const file = fileInput.files[0];
            resultDiv.innerHTML = 'Uploading...';
            
            try {
                const result = await ImportAPI.uploadCSV(file);
                resultDiv.innerHTML = `
                    <h3>Upload Successful!</h3>
                    <p><strong>ID:</strong> ${result.id}</p>
                    <p><strong>Filename:</strong> ${result.filename}</p>
                    <p><strong>Status:</strong> ${result.status}</p>
                    <p><strong>File Size:</strong> ${result.file_size} bytes</p>
                    
                    <button onclick="testPreview('${result.id}')">Test Preview</button>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<h3>Upload Failed:</h3> <p>${error.message}</p>`;
            }
        }
        
        async function testPreview(importId) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Loading preview...';
            
            try {
                const preview = await ImportAPI.getImportPreview(importId);
                resultDiv.innerHTML = `
                    <h3>Preview Loaded!</h3>
                    <p><strong>Rows Detected:</strong> ${preview.total_rows}</p>
                    <p><strong>Status:</strong> ${preview.status}</p>
                    <p><strong>Detection Confidence:</strong> ${Math.round((preview.detected_columns?.detection_confidence || 0) * 100)}%</p>
                    
                    <h4>Detected Columns:</h4>
                    <ul>
                        ${Object.entries(preview.detected_columns?.columns || {}).map(([key, col]) => 
                            `<li><strong>${key}:</strong> ${col.source_column} (confidence: ${Math.round(col.confidence * 100)}%)</li>`
                        ).join('')}
                    </ul>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<h3>Preview Failed:</h3> <p>${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
